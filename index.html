<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shillette - Advanced DMA Firmware</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <style type="text/tailwindcss">
        @keyframes animateGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes spinBorder {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes fall {
            0% { transform: translateY(-10vh) translateX(0); opacity: 1; }
            100% { transform: translateY(110vh) translateX(5vw); opacity: 0; }
        }

        @keyframes scaleUpDown {
            0%, 100% { transform: scaleY(0.4); }
            20% { transform: scaleY(1.0); }
        }

        body {
            font-family: 'Inter', sans-serif;
            @apply bg-gradient-to-br from-orange-700 via-black to-black text-gray-300;
            background-size: 200% 200%;
            animation: animateGradient 25s ease infinite;
            overflow-x: hidden;
            position: relative;
            z-index: 0;
        }

        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background-image: url('images/background.png');
            background-size: cover;
            background-position: center center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            opacity: 0.2;
            z-index: -1;
        }


        .hero-bg-element { }

        #snow-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 40;
            overflow: hidden;
        }

        .snowflake {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            pointer-events: none;
            animation-name: fall;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
        }


        .card-gradient-border::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 0.5rem;
            padding: 2px;
            background-size: 300% 300%;
            animation: spinBorder 5s linear infinite;
            -webkit-mask:
                linear-gradient(#fff 0 0) content-box,
                linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            pointer-events: none;
            z-index: -1;
        }

        .card-gradient-border.orange-border::before {
            background-image: linear-gradient(145deg, #f97316, #9a3412, #000000);
        }

        .card-gradient-border.gray-border::before {
             background-image: linear-gradient(145deg, #9ca3af, #374151, #000000);
             animation-duration: 6s;
        }

        .product-card {
            @apply relative bg-slate-800/80 backdrop-blur-sm rounded-lg p-6 shadow-xl flex flex-col transition-transform duration-300 ease-in-out hover:scale-[1.03] z-0;
             overflow: hidden;
        }

        #dashboard-content h2, #products-page-content h2, #tickets-page-content h2, #ticket-detail-content h2 { @apply text-3xl md:text-4xl font-bold text-white text-center mb-12; }
        #dashboard-content .dashboard-card, #tickets-page-content .ticket-card, #ticket-detail-content .ticket-card { @apply bg-slate-800/80 backdrop-blur-sm p-6 rounded-lg shadow-lg; }

        .paypal-button { @apply bg-sky-600 hover:bg-sky-700 text-white text-sm font-medium py-2 px-4 rounded-md transition duration-300 flex items-center justify-center space-x-2 w-full; }

        #payment-message, #ticket-message, #error-message {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            @apply text-white text-sm font-medium py-2 px-5 rounded-lg shadow-lg opacity-0 transition-opacity duration-500 ease-in-out z-50 pointer-events-none;
        }
         #payment-message.show, #ticket-message.show, #error-message.show {
             opacity: 1;
         }
         #payment-message, #ticket-message { @apply bg-green-600; }
         #error-message { @apply bg-red-600; }


        #loading-overlay {
            position: fixed;
            inset: 0;
            @apply bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 transition-opacity duration-300 ease-in-out;
        }
        #loading-overlay.opacity-0 {
             @apply pointer-events-none;
        }

        .loader {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 50px;
            height: 25px;
        }
        .loader-bar {
            display: block;
            width: 8px;
            height: 100%;
            background-color: #f97316;
            border-radius: 4px;
            animation: scaleUpDown 1.2s infinite ease-in-out;
        }
        .loader-bar:nth-child(2) {
            animation-delay: 0.2s;
        }
        .loader-bar:nth-child(3) {
            animation-delay: 0.4s;
        }

        .content-blur {
            @apply filter blur-sm transition-all duration-300 ease-in-out;
        }

        .ticket-list-item {
            @apply bg-slate-700/50 p-4 rounded-md mb-3 flex justify-between items-center cursor-pointer hover:bg-slate-600/50 transition-colors;
        }
        .status-open { @apply bg-green-500 text-green-900 text-xs font-bold px-2 py-0.5 rounded-full; }
        .status-closed { @apply bg-red-500 text-red-900 text-xs font-bold px-2 py-0.5 rounded-full; }

        #chat-messages {
             @apply h-64 md:h-80 overflow-y-auto mb-4 p-3 bg-slate-900/50 rounded-md border border-slate-700 space-y-2;
        }
        .chat-message {
             @apply text-sm break-words; /* Allow long words to wrap */
        }
        .chat-message .username {
             @apply font-semibold text-orange-400 mr-2;
        }
         .chat-message .timestamp {
             @apply text-xs text-gray-500 ml-2 whitespace-nowrap; /* Prevent timestamp wrap */
         }
         #chat-input-form {
             @apply flex space-x-2;
         }
         #chat-input {
              @apply flex-grow bg-slate-700 border border-slate-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent placeholder-gray-500;
         }
         #send-chat-button {
             @apply bg-orange-600 hover:bg-orange-700 text-white font-medium py-2 px-4 rounded-lg transition duration-300;
         }

    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div id="snow-container"></div>
    <div id="payment-message">Placeholder</div>
    <div id="ticket-message">Placeholder</div>
    <div id="error-message">Placeholder</div>

    <div id="loading-overlay" class="hidden opacity-0 pointer-events-none">
        <div class="loader">
            <span class="loader-bar"></span>
            <span class="loader-bar"></span>
            <span class="loader-bar"></span>
        </div>
    </div>

    <header class="py-4 sticky top-0 z-20 bg-gray-900/80 backdrop-blur-md border-b border-gray-700/50">
        <div class="container mx-auto px-6 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <img src="images/icon.png" alt="Shillette Icon" class="w-8 h-8" onerror="this.style.display='none'">
                <span class="text-2xl font-bold text-white">Shillette</span>
            </div>
            <div class="flex items-center space-x-6">
                <nav class="hidden md:flex space-x-6">
                    <a href="#" id="home-link" class="text-gray-300 hover:text-white transition duration-200">Home</a>
                    <a href="#" id="products-link" class="text-gray-300 hover:text-white transition duration-200">Products</a>
                    <a href="#" id="tickets-link" class="text-gray-300 hover:text-white transition duration-200">Tickets</a>
                    <a href="https://discord.gg/shillette" target="_blank" rel="noopener noreferrer" class="text-gray-300 hover:text-white transition duration-200">Discord</a>
                </nav>
                <div id="user-area" class="flex items-center">
                    <a id="login-button" href="https://api.shillette.com/login" class="bg-orange-600 hover:bg-orange-700 text-white text-sm font-medium py-2 px-4 rounded-lg transition duration-300 flex items-center space-x-2">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19.54 6.04a13.27 13.27 0 00-2.66-1.89 12.4 12.4 0 00-1.6-1.3c-.4-.3-.82-.53-1.28-.71-.18-.07-.37-.13-.56-.19a.82.82 0 00-.5-.06 11.85 11.85 0 00-5.88 0 .82.82 0 00-.5.06c-.19.06-.38.12-.56.19-.46.18-.88.4-1.28.7a12.34 12.34 0 00-1.6 1.3A13.23 13.23 0 004.46 6.04 14.31 14.31 0 003 11.7c0 .1 0 .19.02.28a13.8 13.8 0 001.44 4.61c.56 1.1 1.24 2.1 2.04 3 .5.56 1.04 1.07 1.63 1.53.17.13.34.25.52.37a.8.8 0 00.57.19.78.78 0 00.57-.19 11.07 11.07 0 005.56 0 .78.78 0 00.57.19.8.8 0 00.57-.19c.18-.12.35-.24.52-.37a12.06 12.06 0 003.67-4.53 13.85 13.85 0 001.44-4.61c0-.1 0-.19.02-.28a14.31 14.31 0 00-1.46-5.66zm-4.61 7.03a1.93 1.93 0 01-3.86 0 1.93 1.93 0 013.86 0zm-5.72 0a1.93 1.93 0 01-3.86 0 1.93 1.93 0 013.86 0z"></path></svg>
                        <span>Login with Discord</span>
                    </a>
                    <div id="user-info" class="hidden items-center space-x-3 hover:bg-slate-700/50 p-1.5 rounded-lg transition duration-200 cursor-pointer">
                        <img id="user-avatar" src="https://placehold.co/32x32/7f8c8d/ecf0f1?text=?" alt="User Avatar" class="w-8 h-8 rounded-full border-2 border-slate-600">
                        <span id="user-name" class="text-white text-sm font-medium">Username</span>
                        <button id="logout-button" class="text-gray-400 hover:text-white text-xs font-medium bg-slate-600 hover:bg-slate-500 px-2 py-1 rounded-md transition duration-200">Logout</button>
                    </div>
                </div>
            </div>
            <div class="md:hidden">
                <button class="text-gray-300 hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>
        </div>
    </header>

    <main id="main-content" class="flex-grow">
        <section class="relative text-center py-24 md:py-32 lg:py-40 overflow-hidden">
            <div class="hero-bg-element"></div>
            <div class="container mx-auto px-6 relative z-10">
                <h1 class="text-4xl md:text-5xl lg:text-6xl font-extrabold text-white mb-4">Shillette</h1>
                <p class="text-xl md:text-2xl text-orange-400 mb-6 font-medium">Advanced DMA Firmware</p>
                <p class="max-w-2xl mx-auto text-gray-400 mb-10">
                    Fully undetected DMA firmware, battle-tested for reliable performance. Join thousands of satisfied users.
                </p>
                <div class="flex flex-col sm:flex-row justify-center items-center space-y-4 sm:space-y-0 sm:space-x-4 mb-16">
                    <button id="purchase-button" class="bg-orange-600 hover:bg-orange-700 text-white font-semibold py-3 px-8 rounded-lg transition duration-300 shadow-lg w-full sm:w-auto">
                        Purchase Product
                    </button>
                    <a href="https://discord.gg/shillette" target="_blank" rel="noopener noreferrer" class="bg-gray-700 hover:bg-gray-600 text-white font-semibold py-3 px-8 rounded-lg transition duration-300 shadow-lg w-full sm:w-auto flex items-center justify-center space-x-2">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19.54 6.04a13.27 13.27 0 00-2.66-1.89 12.4 12.4 0 00-1.6-1.3c-.4-.3-.82-.53-1.28-.71-.18-.07-.37-.13-.56-.19a.82.82 0 00-.5-.06 11.85 11.85 0 00-5.88 0 .82.82 0 00-.5.06c-.19.06-.38.12-.56.19-.46.18-.88.4-1.28.7a12.34 12.34 0 00-1.6 1.3A13.23 13.23 0 004.46 6.04 14.31 14.31 0 003 11.7c0 .1 0 .19.02.28a13.8 13.8 0 001.44 4.61c.56 1.1 1.24 2.1 2.04 3 .5.56 1.04 1.07 1.63 1.53.17.13.34.25.52.37a.8.8 0 00.57.19.78.78 0 00.57-.19 11.07 11.07 0 005.56 0 .78.78 0 00.57.19.8.8 0 00.57-.19c.18-.12.35-.24.52-.37a12.06 12.06 0 003.67-4.53 13.85 13.85 0 001.44-4.61c0-.1 0-.19.02-.28a14.31 14.31 0 00-1.46-5.66zm-4.61 7.03a1.93 1.93 0 01-3.86 0 1.93 1.93 0 013.86 0zm-5.72 0a1.93 1.93 0 01-3.86 0 1.93 1.93 0 013.86 0z"></path></svg>
                        <span>Join Discord</span>
                    </a>
                </div>
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-8 max-w-3xl mx-auto text-gray-400">
                    <div class="text-center">
                        <div class="text-3xl font-bold text-white mb-1">1000+</div>
                        <div>Happy Users</div>
                    </div>
                    <div class="text-center">
                        <div class="text-3xl font-bold text-white mb-1">1000+</div>
                        <div>Products Sold</div>
                    </div>
                    <div class="text-center">
                        <div class="text-3xl font-bold text-white mb-1">5.0</div>
                        <div>Star Rating</div>
                    </div>
                    <div class="text-center">
                        <div class="text-3xl font-bold text-white mb-1">3+</div>
                        <div>Years Experience</div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <div id="products-page-content" class="hidden flex-grow container mx-auto px-6 py-10">
        <div class="flex justify-start mb-8">
             <button id="back-to-home-button-products" class="text-orange-400 hover:text-orange-300 flex items-center space-x-2 transition duration-200">
                 <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                 <span>Back to Home</span>
             </button>
        </div>
        <h2>Our Products</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-5xl mx-auto">
            <div class="product-card card-gradient-border orange-border">
                <div class="flex justify-between items-center mb-4">
                    <span class="bg-orange-500/20 text-orange-300 text-xs font-semibold px-2.5 py-0.5 rounded">ALL IN ONE</span>
                    <div class="flex space-x-2 text-yellow-400">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>
                    </div>
                </div>
                <h3 class="text-xl font-semibold text-white mb-2">Shillette Firmware</h3>
                <p class="text-3xl font-bold text-white mb-4">From $100</p>
                <ul class="text-sm text-gray-400 space-y-2 mb-6 flex-grow">
                    <li class="flex items-center"><svg class="w-4 h-4 mr-2 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> Fully Undetected</li>
                    <li class="flex items-center"><svg class="w-4 h-4 mr-2 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> Easy Installation</li>
                    <li class="flex items-center"><svg class="w-4 h-4 mr-2 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> Full Support</li>
                    <li class="flex items-center"><svg class="w-4 h-4 mr-2 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> Lifetime Updates</li>
                </ul>
                <div class="mt-auto space-y-3 pt-4 border-t border-slate-700/50">
                     <button class="paypal-button" data-product-id="firmware-100">Pay with PayPal</button>
                </div>
            </div>

            <div class="product-card card-gradient-border gray-border">
                <div class="flex justify-between items-center mb-4">
                    <span class="bg-gray-500/20 text-gray-300 text-xs font-semibold px-2.5 py-0.5 rounded">SOFTWARE</span>
                     <div class="w-12 h-12 bg-gray-700 rounded flex items-center justify-center text-gray-400">
                         <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                     </div>
                </div>
                <h3 class="text-xl font-semibold text-white mb-2">Shillette Software</h3>
                <p class="text-3xl font-bold text-white mb-4">From $3</p>
                <ul class="text-sm text-gray-400 space-y-2 mb-6 flex-grow">
                    <li class="flex items-center"><svg class="w-4 h-4 mr-2 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> Feature Rich</li>
                    <li class="flex items-center"><svg class="w-4 h-4 mr-2 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> Highly Compatible</li>
                    <li class="flex items-center"><svg class="w-4 h-4 mr-2 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> Regular Updates</li>
                </ul>
                 <div class="mt-auto space-y-3 pt-4 border-t border-slate-700/50">
                     <button class="paypal-button" data-product-id="software-3">Pay with PayPal</button>
                </div>
            </div>
        </div>
    </div>

    <div id="dashboard-content" class="hidden flex-grow container mx-auto px-6 py-10">
        <h2>Dashboard</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="dashboard-card md:col-span-1">
                <h3 class="text-lg font-semibold text-white mb-4">Welcome!</h3>
                <div class="flex items-center space-x-4 mb-4">
                     <img id="dashboard-user-avatar" src="https://placehold.co/64x64/7f8c8d/ecf0f1?text=?" alt="User Avatar" class="w-16 h-16 rounded-full border-2 border-orange-500">
                     <div>
                         <p id="dashboard-user-name" class="text-xl font-semibold text-white">Username</p>
                         <p class="text-sm text-gray-400">Status: Active</p>
                     </div>
                </div>
                <button id="dashboard-logout-button" class="w-full bg-red-600 hover:bg-red-700 text-white text-sm font-medium py-2 px-4 rounded-lg transition duration-300">
                    Logout
                </button>
            </div>

            <div class="dashboard-card md:col-span-2">
                <h3 class="text-lg font-semibold text-white mb-4">My Products</h3>
                <p class="text-gray-400">Product information will appear here...</p>
            </div>

            <div class="dashboard-card md:col-span-3">
                 <h3 class="text-lg font-semibold text-white mb-4">Settings</h3>
                 <p class="text-gray-400">User settings will appear here...</p>
            </div>
        </div>
    </div>

     <div id="tickets-page-content" class="hidden flex-grow container mx-auto px-6 py-10">
         <div class="flex justify-start mb-8">
             <button id="back-to-home-button-tickets" class="text-orange-400 hover:text-orange-300 flex items-center space-x-2 transition duration-200">
                 <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                 <span>Back to Home</span>
             </button>
        </div>
        <h2>Support Tickets</h2>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2 ticket-card">
                 <h3 class="text-xl font-semibold text-white mb-4">My Tickets</h3>
                 <div id="ticket-list" class="space-y-3 max-h-96 overflow-y-auto pr-2">
                 </div>
                 <p id="ticket-list-status" class="text-sm text-gray-500 mt-4">Loading tickets...</p>
            </div>
            <div class="lg:col-span-1 ticket-card">
                 <h3 class="text-xl font-semibold text-white mb-4">Create New Ticket</h3>
                 <form id="create-ticket-form">
                     <div class="mb-4">
                         <label for="ticket-subject" class="block text-sm font-medium text-gray-300 mb-1">Subject</label>
                         <input type="text" id="ticket-subject" name="ticket-subject" required class="w-full bg-slate-700 border border-slate-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent placeholder-gray-500">
                     </div>
                     <div class="mb-4">
                         <label for="ticket-message" class="block text-sm font-medium text-gray-300 mb-1">Message</label>
                         <textarea id="ticket-message" name="ticket-message" rows="4" required class="w-full bg-slate-700 border border-slate-600 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent placeholder-gray-500"></textarea>
                     </div>
                     <button type="submit" id="create-ticket-button" class="w-full bg-orange-600 hover:bg-orange-700 text-white font-medium py-2.5 px-6 rounded-lg transition duration-300">
                         Submit Ticket
                     </button>
                 </form>
            </div>
        </div>
     </div>

     <div id="ticket-detail-content" class="hidden flex-grow container mx-auto px-6 py-10">
         <div class="flex justify-start mb-8">
             <button id="back-to-tickets-button" class="text-orange-400 hover:text-orange-300 flex items-center space-x-2 transition duration-200">
                 <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                 <span>Back to Tickets</span>
             </button>
        </div>
        <h2 id="ticket-detail-subject">Ticket Subject</h2>
        <div class="ticket-card">
            <div id="chat-messages">
                <p class="text-gray-500 text-center py-4">Loading chat...</p>
            </div>
            <form id="chat-input-form" class="mt-4">
                 <input type="text" id="chat-input" placeholder="Type your message..." required class="w-full">
                 <button type="submit" id="send-chat-button">Send</button>
            </form>
        </div>
     </div>


    <footer class="bg-black mt-auto py-6 border-t border-gray-800">
        <div class="container mx-auto px-6 text-center text-gray-500 text-sm">
            <p>&copy; 2025 Shillette. All rights reserved.</p>
        </div>
    </footer>

    <script>
        const loginButton = document.getElementById('login-button');
        const logoutButton = document.getElementById('logout-button');
        const dashboardLogoutButton = document.getElementById('dashboard-logout-button');
        const mainContent = document.getElementById('main-content');
        const dashboardContent = document.getElementById('dashboard-content');
        const productsPageContent = document.getElementById('products-page-content');
        const ticketsPageContent = document.getElementById('tickets-page-content');
        const ticketDetailContent = document.getElementById('ticket-detail-content');
        const userInfo = document.getElementById('user-info');
        const userNameDisplay = document.getElementById('user-name');
        const userAvatarDisplay = document.getElementById('user-avatar');
        const dashboardUserNameDisplay = document.getElementById('dashboard-user-name');
        const dashboardUserAvatarDisplay = document.getElementById('dashboard-user-avatar');
        const snowContainer = document.getElementById('snow-container');
        const homeLink = document.getElementById('home-link');
        const productsLink = document.getElementById('products-link');
        const ticketsLink = document.getElementById('tickets-link');
        const backToHomeButtonProducts = document.getElementById('back-to-home-button-products');
        const backToHomeButtonTickets = document.getElementById('back-to-home-button-tickets');
        const backToTicketsButton = document.getElementById('back-to-tickets-button');
        const paymentMessage = document.getElementById('payment-message');
        const ticketMessage = document.getElementById('ticket-message');
        const errorMessage = document.getElementById('error-message');
        const purchaseButton = document.getElementById('purchase-button');
        const loadingOverlay = document.getElementById('loading-overlay');
        const pageContainers = document.querySelectorAll('#main-content, #products-page-content, #dashboard-content, #tickets-page-content, #ticket-detail-content');
        const createTicketForm = document.getElementById('create-ticket-form');
        const ticketSubjectInput = document.getElementById('ticket-subject');
        const ticketMessageInput = document.getElementById('ticket-message');
        const ticketListDiv = document.getElementById('ticket-list');
        const ticketListStatus = document.getElementById('ticket-list-status');
        const ticketDetailSubject = document.getElementById('ticket-detail-subject');
        const chatMessagesDiv = document.getElementById('chat-messages');
        const chatInputForm = document.getElementById('chat-input-form');
        const chatInput = document.getElementById('chat-input');
        const sendChatButton = document.getElementById('send-chat-button');

        const API_BASE_URL = 'https://api.shillette.com';
        const SOCKET_URL = 'https://api.shillette.com';

        let currentUser = null;
        let socket = null;
        let currentTicketId = null;

        function showMessage(element, message, isError = false) {
             if (!element) return;
             element.textContent = message;
             if (isError) {
                 element.classList.remove('bg-green-600');
                 element.classList.add('bg-red-600');
             } else {
                 element.classList.remove('bg-red-600');
                 element.classList.add('bg-green-600');
             }
             element.classList.add('show');
             setTimeout(() => {
                 element.classList.remove('show');
             }, 3000);
         }

        function hideAllSections() {
             mainContent.classList.add('hidden');
             dashboardContent.classList.add('hidden');
             productsPageContent.classList.add('hidden');
             ticketsPageContent.classList.add('hidden');
             ticketDetailContent.classList.add('hidden');
             disconnectSocket();
        }

        function showSectionWithLoading(showFunction) {
            if (!loadingOverlay) { showFunction(); return; }

            pageContainers.forEach(container => container.classList.add('content-blur'));
            loadingOverlay.classList.remove('hidden', 'opacity-0', 'pointer-events-none');
            loadingOverlay.classList.add('pointer-events-auto');


            setTimeout(() => {
                hideAllSections();
                showFunction();
                pageContainers.forEach(container => container.classList.remove('content-blur'));
                loadingOverlay.classList.add('opacity-0');
                loadingOverlay.classList.remove('pointer-events-auto');
                loadingOverlay.classList.add('pointer-events-none');
                setTimeout(() => {
                    loadingOverlay.classList.add('hidden');
                }, 300);
            }, 500);
        }

        function updateHeaderUI(user) {
             if (user && user.logged_in) {
                 loginButton.classList.add('hidden');
                 userInfo.classList.remove('hidden');
                 userInfo.classList.add('flex');
                 userNameDisplay.textContent = user.username || 'User';
                 if (user.user_id && user.avatar) {
                     userAvatarDisplay.src = `https://cdn.discordapp.com/avatars/${user.user_id}/${user.avatar}.png?size=32`;
                 } else {
                     userAvatarDisplay.src = 'https://placehold.co/32x32/7f8c8d/ecf0f1?text=?';
                 }
                 dashboardUserNameDisplay.textContent = user.username || 'User';
                 if (user.user_id && user.avatar) {
                    dashboardUserAvatarDisplay.src = `https://cdn.discordapp.com/avatars/${user.user_id}/${user.avatar}.png?size=64`;
                 } else {
                    dashboardUserAvatarDisplay.src = 'https://placehold.co/64x64/7f8c8d/ecf0f1?text=?';
                 }

             } else {
                 loginButton.classList.remove('hidden');
                 userInfo.classList.add('hidden');
                 userInfo.classList.remove('flex');
             }
        }


        function showDashboardInternal() {
            dashboardContent.classList.remove('hidden');
            localStorage.setItem('currentPage', 'dashboard');
            updateHeaderUI(currentUser);
        }

        function showMainContentInternal() {
            mainContent.classList.remove('hidden');
            localStorage.setItem('currentPage', 'home');
            updateHeaderUI(currentUser);
        }

        function showProductsPageInternal() {
            productsPageContent.classList.remove('hidden');
            localStorage.setItem('currentPage', 'products');
            updateHeaderUI(currentUser);
        }

        function showTicketsPageInternal() {
            ticketsPageContent.classList.remove('hidden');
            localStorage.setItem('currentPage', 'tickets');
            updateHeaderUI(currentUser);
            fetchTickets();
        }

        function showTicketDetailInternal(ticketId, ticketSubject) {
             ticketDetailContent.classList.remove('hidden');
             localStorage.setItem('currentPage', 'ticketDetail');
             currentTicketId = ticketId;
             ticketDetailSubject.textContent = ticketSubject || `Ticket #${ticketId.slice(-6)}`;
             chatMessagesDiv.innerHTML = '<p class="text-gray-500 text-center py-4">Connecting to chat...</p>';
             updateHeaderUI(currentUser);
             connectSocket(ticketId);
        }


        function showDashboard() {
            if (!currentUser || !currentUser.logged_in) {
                 showMessage(errorMessage, "Please log in to view the dashboard.", true);
                 return;
            }
            showSectionWithLoading(showDashboardInternal);
        }
        function showMainContent() {
            showSectionWithLoading(showMainContentInternal);
        }
        function showProductsPage() {
             showSectionWithLoading(showProductsPageInternal);
        }
        function showTicketsPage() {
             if (!currentUser || !currentUser.logged_in) {
                 showMessage(errorMessage, "Please log in to view tickets.", true);
                 return;
             }
             showSectionWithLoading(showTicketsPageInternal);
        }
         function showTicketDetail(ticketId, ticketSubject) {
             if (!currentUser || !currentUser.logged_in) {
                 showMessage(errorMessage, "Please log in to view ticket details.", true);
                 return;
             }
             showSectionWithLoading(() => showTicketDetailInternal(ticketId, ticketSubject));
         }


        function createSnowflakes() {
            const numberOfSnowflakes = 75;
            if (!snowContainer) return;
            snowContainer.innerHTML = '';
            for (let i = 0; i < numberOfSnowflakes; i++) {
                const snowflake = document.createElement('div');
                snowflake.classList.add('snowflake');

                const size = Math.random() * 3 + 2;
                const duration = Math.random() * 10 + 5;
                const delay = Math.random() * 10;
                const startLeft = Math.random() * 100;
                const opacity = Math.random() * 0.5 + 0.5;

                snowflake.style.width = `${size}px`;
                snowflake.style.height = `${size}px`;
                snowflake.style.left = `${startLeft}vw`;
                snowflake.style.opacity = opacity;
                snowflake.style.animationDuration = `${duration}s`;
                snowflake.style.animationDelay = `-${delay}s`;

                snowContainer.appendChild(snowflake);
            }
        }

        async function checkLoginStatus() {
             try {
                 const response = await fetch(`${API_BASE_URL}/api/user`);
                 if (!response.ok) {
                     if (response.status === 401 || response.status === 403) {
                         currentUser = { logged_in: false };
                     } else {
                        throw new Error(`HTTP error! status: ${response.status}`);
                     }
                 } else {
                    currentUser = await response.json();
                 }
                 console.log("User status:", currentUser);
             } catch (error) {
                 console.error("Error checking login status:", error);
                 currentUser = { logged_in: false };
             } finally {
                 const currentPage = localStorage.getItem('currentPage');
                 hideAllSections();
                 if (currentUser.logged_in && currentPage === 'dashboard') {
                     showDashboardInternal();
                 } else if (currentPage === 'products') {
                     showProductsPageInternal();
                 } else if (currentUser.logged_in && currentPage === 'tickets') {
                     showTicketsPageInternal();
                 } else if (currentUser.logged_in && currentPage === 'ticketDetail') {
                      showTicketsPageInternal();
                 }
                  else {
                     showMainContentInternal();
                 }
                 updateHeaderUI(currentUser);
             }
        }

        async function fetchTickets() {
            if (!ticketListDiv || !ticketListStatus) return;
            if (!currentUser || !currentUser.logged_in) {
                ticketListStatus.textContent = "Please log in to view tickets.";
                return;
            }

            ticketListStatus.textContent = "Loading tickets...";
            ticketListDiv.innerHTML = '';

            try {
                const response = await fetch(`${API_BASE_URL}/api/tickets`);
                if (!response.ok) {
                     if (response.status === 401 || response.status === 403) {
                         throw new Error("Not authorized to view tickets.");
                     } else {
                        throw new Error(`HTTP error! status: ${response.status}`);
                     }
                }
                const tickets = await response.json();

                if (tickets.length === 0) {
                    ticketListStatus.textContent = "You have no support tickets.";
                } else {
                    ticketListStatus.textContent = "";
                    tickets.forEach(ticket => {
                        const item = document.createElement('div');
                        item.classList.add('ticket-list-item');
                        const statusClass = ticket.status === 'open' ? 'status-open' : 'status-closed';
                        const dateOpened = ticket.created_at ? new Date(ticket.created_at).toLocaleDateString() : 'N/A';
                        const ticketId = ticket._id || 'N/A';
                        const subject = ticket.subject || 'No Subject';

                        item.innerHTML = `
                            <div>
                                <p class="font-medium text-white">Ticket #${ticketId.slice(-6)}: ${subject}</p>
                                <p class="text-xs text-gray-400">Opened: ${dateOpened}</p>
                            </div>
                            <span class="${statusClass}">${ticket.status || 'N/A'}</span>
                        `;
                        item.addEventListener('click', () => showTicketDetail(ticketId, subject));
                        ticketListDiv.appendChild(item);
                    });
                }
            } catch (error) {
                console.error("Error fetching tickets:", error);
                ticketListStatus.textContent = `Failed to load tickets: ${error.message}`;
            }
        }

        function appendChatMessage(data) {
             if (!chatMessagesDiv) return;
             // Clear loading message if present
             const loadingMsg = chatMessagesDiv.querySelector('p.text-gray-500');
             if (loadingMsg) loadingMsg.remove();

             const messageElement = document.createElement('div');
             messageElement.classList.add('chat-message');
             const timestamp = data.timestamp ? new Date(data.timestamp).toLocaleTimeString() : '';
             // Basic sanitation (replace potential HTML tags)
             const safeUsername = (data.username || 'System').replace(/</g, "&lt;").replace(/>/g, "&gt;");
             const safeText = (data.text || '').replace(/</g, "&lt;").replace(/>/g, "&gt;");

             messageElement.innerHTML = `<span class="username">${safeUsername}:</span> ${safeText} <span class="timestamp">${timestamp}</span>`;
             chatMessagesDiv.appendChild(messageElement);
             chatMessagesDiv.scrollTop = chatMessagesDiv.scrollHeight;
        }

        function connectSocket(ticketId) {
            if (socket && socket.connected) {
                socket.emit('join_ticket_room', { ticket_id: ticketId });
                return;
            }
            if (socket) { // Clean up old listeners if socket exists but isn't connected
                 socket.off('connect');
                 socket.off('disconnect');
                 socket.off('connect_error');
                 socket.off('new_message');
                 socket.off('room_joined');
                 socket.off('past_messages'); // Add listener removal for past messages if used
                 socket.off('error_message'); // Add listener removal for errors
            }

            socket = io(SOCKET_URL, {
                reconnectionAttempts: 3,
                // Add withCredentials: true if using cookies for session auth across domains
                // withCredentials: true,
            });

            socket.on('connect', () => {
                console.log('WebSocket connected:', socket.id);
                appendChatMessage({text: 'Connected to chat.'});
                socket.emit('join_ticket_room', { ticket_id: ticketId });
            });

            socket.on('disconnect', (reason) => {
                console.log('WebSocket disconnected:', reason);
                appendChatMessage({text: `Disconnected: ${reason}`});
                currentTicketId = null; // Clear ticket ID on disconnect
            });

            socket.on('connect_error', (error) => {
                 console.error('WebSocket connection error:', error);
                 appendChatMessage({text: `Connection error: ${error.message}`});
            });

            socket.on('new_message', (data) => {
                console.log('New message received:', data);
                if (data.ticket_id === currentTicketId) {
                     appendChatMessage(data);
                }
            });

             socket.on('room_joined', (data) => {
                 console.log('Joined room:', data.room);
                 appendChatMessage({text: `Joined ticket room.`});
                 // TODO: Fetch past messages for this ticket via API or socket event
                 // fetchPastMessages(ticketId);
             });

             socket.on('error_message', (data) => {
                 console.error('Server error message:', data.message);
                 showMessage(errorMessage, data.message || 'An error occurred.', true);
             });
        }

        function disconnectSocket() {
            if (socket) {
                console.log('Disconnecting socket...');
                socket.disconnect();
                socket = null;
            }
             currentTicketId = null;
        }


        // --- Event Listeners ---

        loginButton.addEventListener('click', (e) => {
             e.preventDefault();
             window.location.href = loginButton.href;
        });

        logoutButton.addEventListener('click', async () => {
            console.log('Logging out...');
            try {
                 const response = await fetch(`${API_BASE_URL}/logout`);
                 if (!response.ok) { throw new Error('Logout request failed'); }
                 currentUser = { logged_in: false };
                 localStorage.removeItem('isLoggedIn');
                 localStorage.removeItem('currentPage');
                 showMainContent();
            } catch(error) {
                 console.error("Logout error:", error);
                 showMessage(errorMessage, "Logout failed. Please try again.", true);
                 currentUser = { logged_in: false };
                 localStorage.removeItem('isLoggedIn');
                 localStorage.removeItem('currentPage');
                 showMainContentInternal();
                 updateHeaderUI(currentUser);
            }
        });

        dashboardLogoutButton.addEventListener('click', () => {
             logoutButton.click();
        });

        if(homeLink) {
            homeLink.addEventListener('click', (event) => {
                event.preventDefault();
                showMainContent();
            });
        }

        if(productsLink) {
            productsLink.addEventListener('click', (event) => {
                event.preventDefault();
                showProductsPage();
            });
        }

        if(ticketsLink) {
             ticketsLink.addEventListener('click', (event) => {
                event.preventDefault();
                showTicketsPage();
            });
        }

         if(backToHomeButtonProducts) {
            backToHomeButtonProducts.addEventListener('click', (event) => {
                event.preventDefault();
                showMainContent();
            });
        }
         if(backToHomeButtonTickets) {
            backToHomeButtonTickets.addEventListener('click', (event) => {
                event.preventDefault();
                showTicketsPage();
            });
        }
         if(backToTicketsButton) {
             backToTicketsButton.addEventListener('click', (event) => {
                 event.preventDefault();
                 showTicketsPage();
             });
         }


        if(userInfo) {
             userInfo.addEventListener('click', (event) => {
                 if (!event.target.closest('#logout-button')) {
                     showDashboard();
                 }
             });
        }

        if(purchaseButton) {
            purchaseButton.addEventListener('click', (event) => {
                event.preventDefault();
                showProductsPage();
            });
        }

        document.addEventListener('click', (event) => {
            const target = event.target.closest('button');
            if (!target) return;

            const productId = target.dataset.productId;
            if (productId && target.classList.contains('paypal-button')) {
                event.preventDefault();
                console.log(`Simulating PayPal payment for product: ${productId}`);
                showMessage(paymentMessage, `Redirecting to PayPal for ${productId}...`);
            }
        });

        if(createTicketForm) {
            createTicketForm.addEventListener('submit', async (event) => {
                event.preventDefault();
                const subject = ticketSubjectInput.value.trim();
                const message = ticketMessageInput.value.trim();
                if (!subject || !message) {
                     showMessage(errorMessage, 'Please fill out both subject and message.', true);
                     return;
                }

                try {
                    const response = await fetch(`${API_BASE_URL}/api/tickets`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ subject, message }),
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    console.log('Ticket created:', result);
                    showMessage(ticketMessage, 'Ticket submitted successfully!');
                    createTicketForm.reset();
                    fetchTickets();

                } catch (error) {
                    console.error('Error creating ticket:', error);
                    showMessage(errorMessage, `Error: ${error.message}`, true);
                }
            });
        }

        if(chatInputForm) {
             chatInputForm.addEventListener('submit', (event) => {
                 event.preventDefault();
                 const messageText = chatInput.value.trim();
                 if (messageText && socket && socket.connected && currentTicketId) {
                     socket.emit('send_message', {
                         ticket_id: currentTicketId,
                         text: messageText
                     });
                     chatInput.value = '';
                 } else if (!socket || !socket.connected) {
                     showMessage(errorMessage, 'Not connected to chat server.', true);
                 } else if (!messageText) {
                      showMessage(errorMessage, 'Cannot send empty message.', true);
                 }
             });
        }


        document.addEventListener('DOMContentLoaded', () => {
            createSnowflakes();
            checkLoginStatus();
        });

    </script>

</body>
</html>
